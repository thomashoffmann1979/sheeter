#!/usr/bin/env node

var fs = require('fs'),
    program = require('commander'),
    pjson = require('../package.json'),
    XLSXReader = require('../lib/reader/xlsxreader').XLSXReader,
    path =  require('path'),
    reader,
    Workbook = require('../lib/workbook/workbook').Workbook;

program
    .version(pjson.version)
    .description('Spreadsheet in your console')

    .option('-s, --show <file>..<table>', 'showing the content of the given spreadsheet file [and table, if more than one table is inside]')
    .option('-e, --edit <file>..<table>', 'edit the content of the given spreadsheet file [and table, if more than one table is inside]')
    .parse(process.argv);

if (program.show){
    

    try{
        reader = new XLSXReader({
            filename: path.join(program.show[0]),
            workbook: new Workbook()
        });

        reader.on('mainReady', function(){
            var list = reader.workbook.getWorkSheetList(),
                i,
                m,
                r,
                line;

            for(i in list){
                m = list[i].getMatrixByRow({nice:true,header:true,rows:true});
                if ((list.length !== 1) && (list[i].title!=program.show[1])){

                    if (typeof program.show[1] == 'undefined'){
                        console.log(list[i].title);
                    }

                }else{
                    console.log(list[i].title+':');
                    for( r in m ){
                        line = '|'+m[r].join('|')+'|';
                        if (( r == 0 )){
                            console.log(line.replace(/./gi, '_'));
                        }
                        console.log('|'+m[r].join('|')+'|');
                        if (( r == 0 )|| ( r == m.length-1 )){
                            console.log(line.replace(/./gi, '_'));
                        }
                    }

                }
            }

        });

        reader.open({},function(err){
            if (err) throw err;
            //console.log('done');
        });
    }catch(err){
        console.log(err)
    }
}
